# å›åˆåˆ¶æˆ˜æ£‹åœ°å›¾ç³»ç»Ÿ - å¿«é€Ÿå‚è€ƒå¡ç‰‡

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### æ¶æ„ï¼ˆæ¨èæ–¹æ¡ˆï¼‰
```
MapRoot (Node2D)
â”œâ”€â”€ TileMapLayer0      # åŸºç¡€åœ°å½¢ (Z=0)
â”œâ”€â”€ TileMapLayer1      # å»ºç­‘è£…é¥° (Z=1)
â”œâ”€â”€ UnitsContainer     # æ£‹å­å®¹å™¨ (Z=2)
â””â”€â”€ HighlightLayer     # é«˜äº®å±‚ (Z=10)
```

### æ•°æ®å­˜å‚¨ï¼ˆç¨€ç– Dictionaryï¼‰
```gdscript
# âœ… æ¨èï¼šåªå­˜æœ‰å†…å®¹çš„æ ¼å­
var map_data = {
    Vector2i(0, 0): 1,  # é™†åœ°
    Vector2i(1, 0): 2,  # æ²³æµ
    # è™šç©ºæ ¼å­ä¸å­˜å‚¨
}

# âŒ ä¸æ¨èï¼šæ»¡æ•°ç»„ï¼ˆæµªè´¹å†…å­˜ï¼‰
var map_array = [[1,1,1,...], [1,2,1,...], ...]
```

## ğŸ“¦ æ ¸å¿ƒç±»é€ŸæŸ¥

| ç±»å | ç”¨é€” | å…³é”®æ–¹æ³• |
|------|------|----------|
| **MapData** | æ•°æ®å­˜å‚¨ | `set_terrain()`, `get_move_cost()`, `save_to_file()` |
| **MapGenerator** | åœ°å›¾ç”Ÿæˆ | `generate_full_map()`, `inject_template()` |
| **MapLoader** | åœºæ™¯åŠ è½½ | `load_map()`, `generate_and_load_map()` |
| **MovementRangeCalculator** | ç§»åŠ¨è®¡ç®— | `calculate_movement_range()`, `calculate_path()` |
| **MapRoot** | æ€»æ§åˆ¶å™¨ | `add_unit()`, `generate_new_map()` |

## ğŸš€ å¸¸ç”¨ä»£ç ç‰‡æ®µ

### 1. ç”Ÿæˆåœ°å›¾
```gdscript
var generator = MapGenerator.new(50, 50, 12345)
var map_data = generator.generate_full_map(2, 3)  # å¹³æ»‘2æ¬¡ï¼Œ3ä¸ªæ‘åº„
```

### 2. åŠ è½½åœ°å›¾
```gdscript
var loader = MapLoader.new()
loader.layer0 = $TileMapLayer0
loader.layer1 = $TileMapLayer1
loader.load_map(map_data)
```

### 3. è®¡ç®—ç§»åŠ¨èŒƒå›´
```gdscript
var calculator = MovementRangeCalculator.new(map_data)
var reachable = calculator.calculate_movement_range(
    Vector2i(10, 10),  # èµ·ç‚¹
    5,                 # ç§»åŠ¨åŠ›
    occupied_cells     # éšœç¢ç‰©
)
```

### 4. æ˜¾ç¤ºé«˜äº®
```gdscript
highlight_layer.show_movement_range(reachable)
highlight_layer.show_path(path)
highlight_layer.clear_highlights()
```

### 5. ç§»åŠ¨æ£‹å­ï¼ˆå¸¦åŠ¨ç”»ï¼‰
```gdscript
var tween = create_tween()
for cell in path:
    var pos = layer.map_to_local(cell)
    tween.tween_property(unit, "position", pos, 0.2)
```

### 6. ä¿å­˜/åŠ è½½
```gdscript
# ä¿å­˜
map_data.save_to_file("user://my_map.json")

# åŠ è½½
var loaded = MapData.load_from_file("user://my_map.json")
```

## âš™ï¸ é…ç½®é€ŸæŸ¥

### åœ°å½¢ç±»å‹
```gdscript
enum TerrainType {
    VOID = 0,      # è™šç©ºï¼ˆä¸å­˜å‚¨ï¼‰
    LAND = 1,      # é™†åœ° æˆæœ¬=1.0
    RIVER = 2,     # æ²³æµ æˆæœ¬=2.0
    MOUNTAIN = 3,  # å±±åœ° æˆæœ¬=INF
    FOREST = 4,    # æ£®æ— æˆæœ¬=1.5
    VILLAGE = 5    # æ‘åº„ æˆæœ¬=1.0
}
```

### ä¿®æ”¹åœ°å½¢æˆæœ¬
```gdscript
# åœ¨ MapData.gd ä¸­
const TERRAIN_COSTS = {
    TerrainType.LAND: 1.0,
    TerrainType.RIVER: 2.0,    # æ”¹æˆ 3.0 è®©æ²³æµæ›´éš¾é€šè¿‡
    TerrainType.FOREST: 1.5
}
```

### ä¿®æ”¹ç”Ÿæˆå‚æ•°
```gdscript
# åœ¨ MapGenerator.gd ä¸­
noise.frequency = 0.05      # è¶Šå°åœ°å½¢è¶Šå¹³æ»‘
noise.noise_type = FastNoiseLite.TYPE_PERLIN  # å™ªå£°ç±»å‹
```

## ğŸ¨ TileSet é…ç½®è¦ç‚¹

### å¿…é¡»é…ç½®
1. **Terrain Sets**ï¼ˆè‡ªåŠ¨è¾¹ç¼˜è¿æ¥ï¼‰
   - Terrain Set 0: é™†åœ°ç³»ç»Ÿ
   - Terrain Set 1: æ²³æµç³»ç»Ÿ

2. **Custom Data Layers**ï¼ˆç§»åŠ¨æˆæœ¬ï¼‰
   - `move_cost` (Float): 1.0 / 2.0 / INF
   - `block_movement` (Bool): true / false

3. **Atlas åæ ‡æ˜ å°„**
```gdscript
# åœ¨ MapLoader.gd ä¸­æ›´æ–°
const TERRAIN_TO_ATLAS = {
    MapData.TerrainType.LAND: Vector2i(0, 0),
    MapData.TerrainType.RIVER: Vector2i(1, 0),
    # ... æ ¹æ®ä½ çš„ TileSet é…ç½®
}
```

## ğŸ› å¸¸è§é—®é¢˜ 1 ç§’è§£å†³

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| åœ°å›¾ä¸æ˜¾ç¤º | æ£€æŸ¥ TileMapLayer æ˜¯å¦è®¾ç½®äº† TileSet |
| è¾¹ç¼˜ä¸è¿æ¥ | é…ç½® Terrain Sets + è°ƒç”¨ `update_internals()` |
| ç§»åŠ¨èŒƒå›´é”™è¯¯ | æ£€æŸ¥ `TERRAIN_COSTS` é…ç½® |
| æ£‹å­å¡é¡¿ | ä¸è¦æŠŠæ£‹å­æ”¾è¿› TileMapLayerï¼Œç”¨ç‹¬ç«‹ Node2D |
| æ–‡ä»¶å¤ªå¤§ | ä½¿ç”¨ Dictionary ç¨€ç–å­˜å‚¨ï¼Œä¸å­˜è™šç©ºæ ¼å­ |

## ğŸ“ å…³é”®æ³¨æ„äº‹é¡¹

### âœ… æ¨èåšæ³•
- ä½¿ç”¨ Dictionary ç¨€ç–å­˜å‚¨
- ä½¿ç”¨ Terrain Sets è‡ªåŠ¨è¿æ¥
- ä½¿ç”¨ AStarGrid2D è®¡ç®—è·¯å¾„
- æ£‹å­ç”¨ç‹¬ç«‹ Node2D + Tween åŠ¨ç”»
- è°ƒç”¨ `layer.update_internals()` æ›´æ–°åœ°å½¢

### âŒ ç¦æ­¢åšæ³•
- ä¸è¦ç”¨æ»¡ 2D æ•°ç»„å­˜å‚¨åœ°å›¾
- ä¸è¦æŠŠæ£‹å­æ”¾è¿› TileMapLayer
- ä¸è¦æ‰‹åŠ¨å¤„ç†åœ°å½¢è¾¹ç¼˜è¿æ¥
- ä¸è¦å­˜å‚¨è™šç©ºæ ¼å­ï¼ˆæµªè´¹å†…å­˜ï¼‰
- ä¸è¦å¿˜è®°è°ƒç”¨ `update_internals()`

## ğŸ® æµ‹è¯•å¿«æ·é”®

åœ¨ `TestMap.tscn` ä¸­ï¼š
- **å·¦é”®ç‚¹å‡»** - é€‰ä¸­/ç§»åŠ¨æ£‹å­
- **G é”®** - ç”Ÿæˆæ–°åœ°å›¾
- **S é”®** - ä¿å­˜åœ°å›¾
- **L é”®** - åŠ è½½åœ°å›¾

## ğŸ“š æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | ç”¨é€” | é˜…è¯»æ—¶é—´ |
|------|------|----------|
| **INDEX.md** | æ€»ç´¢å¼• | 5åˆ†é’Ÿ |
| **QUICKSTART.md** | å¿«é€Ÿå¼€å§‹ | 10åˆ†é’Ÿ |
| **TILESET_SETUP.md** | TileSeté…ç½® | 15åˆ†é’Ÿ |
| **README.md** | å®Œæ•´æ¶æ„ | 30åˆ†é’Ÿ |
| **INTEGRATION.md** | é›†æˆæŒ‡å— | 20åˆ†é’Ÿ |

## ğŸ”§ æ‰©å±•æ¨¡æ¿

### æ·»åŠ æ–°åœ°å½¢
```gdscript
# 1. MapData.gd - æ·»åŠ æšä¸¾
enum TerrainType {
    # ...
    DESERT = 6  # æ–°å¢ï¼šæ²™æ¼ 
}

# 2. MapData.gd - é…ç½®æˆæœ¬
const TERRAIN_COSTS = {
    # ...
    TerrainType.DESERT: 2.5
}

# 3. MapGenerator.gd - æ·»åŠ æ˜ å°„
func _noise_to_terrain(noise_value: float) -> int:
    if noise_value > 0.7:
        return MapData.TerrainType.DESERT

# 4. MapLoader.gd - é…ç½®åæ ‡
const TERRAIN_TO_ATLAS = {
    # ...
    MapData.TerrainType.DESERT: Vector2i(5, 0)
}
```

### è‡ªå®šä¹‰ç”Ÿæˆç®—æ³•
```gdscript
class_name MyGenerator extends MapGenerator

func generate_basic_map() -> MapData:
    var map_data = MapData.new(width, height)
    
    # ä½ çš„è‡ªå®šä¹‰é€»è¾‘
    for x in range(width):
        for y in range(height):
            # ä¾‹å¦‚ï¼šæ£‹ç›˜æ ¼å›¾æ¡ˆ
            var terrain = MapData.TerrainType.LAND if (x + y) % 2 == 0 else MapData.TerrainType.FOREST
            map_data.set_terrain(Vector2i(x, y), terrain)
    
    return map_data
```

## ğŸ“Š æ€§èƒ½å‚è€ƒ

| åœ°å›¾å¤§å° | ç”Ÿæˆæ—¶é—´ | å†…å­˜ | æ¨èç”¨é€” |
|----------|----------|------|----------|
| 30x30 | <50ms | ~2MB | å°å‹æˆ˜æ–— |
| 50x50 | <100ms | ~5MB | ä¸­å‹æˆ˜å½¹ |
| 100x100 | <300ms | ~15MB | å¤§å‹åœ°å›¾ |
| 200x200 | <1s | ~50MB | è¶…å¤§åœ°å›¾ï¼ˆéœ€åˆ†å—ï¼‰ |

## ğŸ“ å­¦ä¹ è·¯å¾„

1. **ç¬¬ä¸€æ­¥**ï¼ˆ10åˆ†é’Ÿï¼‰
   - é˜…è¯» QUICKSTART.md
   - è¿è¡Œ TestMap.tscn

2. **ç¬¬äºŒæ­¥**ï¼ˆ30åˆ†é’Ÿï¼‰
   - é…ç½® TileSetï¼ˆTILESET_SETUP.mdï¼‰
   - æµ‹è¯•åœ°å›¾ç”Ÿæˆ

3. **ç¬¬ä¸‰æ­¥**ï¼ˆ1å°æ—¶ï¼‰
   - é˜…è¯» README.md
   - ç†è§£æ ¸å¿ƒæ¶æ„

4. **ç¬¬å››æ­¥**ï¼ˆ2å°æ—¶ï¼‰
   - é›†æˆåˆ°é¡¹ç›®ï¼ˆINTEGRATION.mdï¼‰
   - è‡ªå®šä¹‰æ‰©å±•

## ğŸ’¡ æœ€ä½³å®è·µ

### åœ°å›¾ç”Ÿæˆ
```gdscript
# âœ… å¥½ï¼šä½¿ç”¨ç§å­ï¼Œå¯é‡ç°
var gen = MapGenerator.new(50, 50, 12345)

# âœ… å¥½ï¼šåå¤„ç†ä¼˜åŒ–
var map = gen.generate_full_map(2, 3)  # å¹³æ»‘+æ‘åº„

# âŒ å·®ï¼šä¸å¹³æ»‘ï¼Œåœ°å½¢æ··ä¹±
var map = gen.generate_basic_map()
```

### ç§»åŠ¨è®¡ç®—
```gdscript
# âœ… å¥½ï¼šè€ƒè™‘éšœç¢ç‰©
var range = calc.calculate_movement_range(pos, 5, occupied)

# âŒ å·®ï¼šå¿½ç•¥éšœç¢ç‰©ï¼Œæ£‹å­é‡å 
var range = calc.calculate_movement_range(pos, 5, [])
```

### æ£‹å­ç®¡ç†
```gdscript
# âœ… å¥½ï¼šé€šè¿‡ MapRoot ç®¡ç†
map_root.add_unit(unit, cell)

# âŒ å·®ï¼šç›´æ¥æ·»åŠ ï¼Œæ— æ³•è¿½è¸ª
units_container.add_child(unit)
```

## ğŸ”— å¿«é€Ÿé“¾æ¥

- **å¼€å§‹ä½¿ç”¨**: INDEX.md â†’ QUICKSTART.md
- **é…ç½® TileSet**: TILESET_SETUP.md
- **é›†æˆé¡¹ç›®**: INTEGRATION.md
- **å®Œæ•´æ–‡æ¡£**: README.md
- **æµ‹è¯•åœºæ™¯**: TestMap.tscn

---

**æ‰“å°è¿™å¼ å¡ç‰‡ï¼Œéšæ—¶æŸ¥é˜…ï¼ğŸ“‹**
